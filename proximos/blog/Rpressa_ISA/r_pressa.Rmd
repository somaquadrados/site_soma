---
title: "R para quem tem pressa"
author: "Isabella Bicalho Frazeto"
date: "28/03/2021"
output: html_document
---

# R para quem tem pressa (ou R para quem n√£o quer aprender R)

![](run_forest.gif)

Esse tutorial √© para voc√™ que precisa aprender **R** por algum motivo de for√ßa maior, n√£o sabe absolutamente nada sobre e precisa de um lugar para come√ßar. O objetivo aqui *n√£o* √© te ensinar a programar, muito menos te ensinar a fazer an√°lises estat√≠sticas, mas sim te ensinar um pouco sobre R e como manipular uma tabela usando dplyr.

## O que voc√™ precisa para seguir esse tutorial?

Esse tutorial vem acompanhado de Rmarkdown (um "editor de texto" que possibilita a inclus√£o de c√≥digos de programa√ß√£o em R dentro dele). O markdown e a tabela que usaremos est√£o dispon√≠veis no meu [GitHub](https://github.com/bellabf/r_pressa) ([O que √© um GitHub?](https://www.somaquadrados.com/blog/git/github/)). Como pr√©-requisitos voc√™ precisa [instalar o R, o Rstudio](https://didatica.tech/como-instalar-a-linguagem-r-e-o-rstudio/) e possuir um *tico* (ü§è) de disposi√ß√£o.

## Por que R?

R √© uma linguagem *open-source* (= voc√™ n√£o precisa pagar uma licen√ßa para us√°-la). O importante √© que, al√©m do que vem com a instala√ß√£o do R (o que costumamos chamar de *R base*), existe a possibilidade de aumentar a usabilidade da linguagem com o uso de *pacotes*¬π. Podemos pensar no R como um super Excel (üí™) capaz de lidar com problemas ligeiramente mais complicados de uma maneira mais eficiente.

<small>

> ¬πUm pacote R (üì¶) √© uma conven√ß√£o para organizar e padronizar a distribui√ß√£o de **fun√ß√µes** extras.
>
> [A ideia b√°sica de uma fun√ß√£o √© encapsular um c√≥digo de programa√ß√£o que pode ser invocado/chamado a qualquer momento. Seu significado e uso s√£o muito semelhantes aos das fun√ß√µes matem√°ticas; h√° um nome, uma defini√ß√£o e uma invoca√ß√£o da fun√ß√£o](https://www.ime.usp.br/~leo/mac2166/2017-1/introducao_funcoes.html). Neste tutorial voc√™ aprender√° sobre algumas fun√ß√µes, como concatena√ß√£o (`c()`) e lista (`list()`).

## Pacotes

Parte do apelo ao R √© justamente a flexibilidade das diferentes ferramentas dispon√≠veis em cada um de seus pacotes. Aqui, usaremos dois (o [dplyr](https://dplyr.tidyverse.org/) e o [ggplot](https://ggplot2.tidyverse.org/index.html)), ambos parte do framework do **‚ú®**[Tidyverse](https://www.tidyverse.org/)**‚ú®**.

O Tidyverse √© uma cole√ß√£o obstinada de pacotes R projetados para ci√™ncia de dados, ou seja, seus pacotes compartilham uma filosofia de design, gram√°tica e estruturas de dados subjacentes. Neste universo magn√≠fico, dplyr e ggplot s√£o considerados essenciais. Al√©m disso, √© poss√≠vel destacar dois pontos:

1.  Muito do apelo comercial do R vem do tidyverse!
2.  Aprender dplyr te coloca um passo mais pr√≥ximo de aprender [SQL (uma linguagem de banco de dados amplamente usada)](https://pt.wikipedia.org/wiki/SQL).

## O b√°sico do R

### Objetos

Ao usar R, a primeira coisa que voc√™ precisa saber √© que letras min√∫sculas e mai√∫sculas t√™m valores diferentes. Ou seja, 'X' e 'x' n√£o s√£o iguais. A segunda informa√ß√£o √© que n√≥s armazenamos (ou indexamos) valores com os quais estamos trabalhando em **objetos**.

Criar um objeto √© uma forma de "salvar valores" dentro da mem√≥ria do nosso computador (objeto **‚Üí** üß†üíª), tornando poss√≠vel "cham√°-los" para uso quando quisermos. Para atribuir um valor a um objeto, usamos um "operador de atribui√ß√£o", composto de um sinal de 'menor' e um h√≠fen (`<-`):

<center>

![](apoio/index.png){width="452"}

</center>

No c√≥digo R, isso √©:

```{r}
identificador <- "valor"
```

**Por exemplo**: Quero armazenar o valor "1" em um objeto chamado "a" e o valor "2" em um objeto chamado "A".

```{r}
a <- 1 
A <- 2
```

Sempre que avaliarmos o objeto "a" (‚ö† Ô∏è**CRTL + Enter** no nome do objeto), o R retornar√° o valor "1", ...

```{r}
a
```

... e para "A", o valor de "2".

```{r}
A
```

Cada objeto pode armazenar apenas uma estrutura de dados por vez (um valor ou uma sequ√™ncia de valores).

### Regras para os nomes dos objetos

-   Podem ser compostos de letras, n√∫meros, "\_" e "." (ex: `dados <- 1`, `dados2 <- 1`, `dados_2 <- 1` e `dados.2 <- 1`)

-   N√£o pode come√ßar com um n√∫mero e/ou um ponto (ex: `1dados <- 1` ou `.dados <- 1`)

-   N√£o pode conter espa√ßos (ex: `dados 2 <- 1`)

-   Evitar o uso de acentua√ß√£o gr√°fica (ex: `n√∫mero <- 1`)

-   Evite usar nomes de fun√ß√µes (ex: `soma`, `diff`, `df`, `var`, `pt`)

-   E lembrar que, como eu j√° disse, o R diferencia mai√∫sculas de min√∫sculas (`obj` ‚â† `OBJ` ‚â† `Obj`)

### Ok, mas quais s√£o os tipos de valores que podemos atribuir a um objeto?

Os objetos possuem tr√™s caracter√≠sticas: Nome + conte√∫do + atributo do conte√∫do.

O atributo pode ser dividido em duas categorias: 1. Classe e 2. Estrutura do dado.

#### Classe

A classe √© essencial em R! √â aqui que fun√ß√µes e operadores podem saber exatamente o que fazer com o(s) objeto(s). Por exemplo, √© poss√≠vel somar dois objetos num√©ricos, ...

```{r}
a + A
```

... mas n√£o podemos somar dois objetos de tipo caracter.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
b <- "bola"
B <- "Bola"
b + B
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
b <- "bola"
B <- "Bola"
print("Error in b + B : non-numeric argument to binary operator")
```

R tem cinco classes b√°sicas de objetos, tamb√©m chamados de objetos at√¥micos, entre elas:

        * Booleanos (ou logical): Valores de verdadeiro ou falso

```{r}
verdade <- TRUE
falso <- FALSE
```

        * N√∫mericos (double ou integer)

```{r}
x <- 1
y <- 2
```

        * Valores de caracteres (ou valores string)

```{r}
meu_nome <- 'Isabella'
```

#### Estrutura do objeto

A estrutura de um objeto √© a forma como os dados s√£o organizados (unidimensional, bidimensional, apenas n√∫meros ou caracteres, etc.). As formas mais comuns com as quais trabalhamos s√£o:

      * Vetores: Objeto unidimensional que possui uma √∫nica classe de valor. Usamos a fun√ß√£o "concatenar" ou c() para atribuir uma s√©rie de valores (separador por v√≠rgula) ao objeto de tipo vetor.  

```{r}
vetor <- c("banana", "ma√ßa", "uva") 
vetor
```

```{r}
vetor2 <- c(1, 2, 3, 5)
vetor2
```

        * Listas: Uma lista √© uma cole√ß√£o unidimensional de objetos. Os objetos que comp√µem uma lista podem conter uma ou mais classes de valores. 

```{r}
lista <- list(A, b, vetor, vetor2, meu_nome)
lista
```

Observe que as listas utilizam como "valores" os objetos que foram criados anteriormente.

        * Dataframe: Tabelas linhas x colunas (aquelas que costumamos trabalhar no Excel)

![](excel.png)

Veremos como importar um data frame para o R na segunda parte deste tutorial.

### E se eu n√£o conseguir identificar qual √© o *tipo* do meu objeto?

Apesar de parecer uma pergunta simples, n√£o conhecer o *tipo* do seu objeto √© um problema que acontece com certa frequ√™ncia. Como solu√ß√£o, voc√™ pode perguntar a classe ou estrutura do seu objeto ao R com a fun√ß√£o `typeof(objeto)`. Essa fun√ß√£o determina o tipo ou modo de armazenamento dos valores de qualquer objeto.

```{r}
typeof(verdade)
```

```{r}
typeof(vetor)
```

```{r}
typeof(lista)
```

### Opera√ß√µes

Uma vez que voc√™ tem um ou mais objetos salvos, voc√™ pode fazer uma s√©rie de opera√ß√µes com eles.

Come√ßando pelo mais simples, voc√™ pode usar o R como uma ‚ú®**calculadora**‚ú®. Por exemplo, √© poss√≠vel subtrair o valor de **x** do objeto **y** (`y-x`),...

```{r}
x <- 23
y <- 37

y-x
x-y

```

Ou at√© mesmo multiplic√°-los (`x*y`) ou dividi-los (`x/y`).

```{r}
x*y
x/y
```

Voc√™ tamb√©m pode comparar valores. Essas opera√ß√µes precisam de alguns s√≠mbolos importantes:

     * & *:* significa E 
     * | *:* significa ou
     * == *:* significa igual

> **‚ö†Ô∏è Aten√ß√£o ‚ö†**Ô∏è:
>
> A compara√ß√£o de valores de objetos sempre √© feita com dois iguais em sequ√™ncia (`objA==objB`). Um √∫nico igual (`objA=objB`) √© para uso de *atribui√ß√£o*, ou seja, tem o mesmo valor que "`objA<-objB`".

     * != *:* diferen√ßa
     * ! *:* nega√ß√£o
     * >= *:* maior igual
     * <= *:* menor igual
     * > *:* maior que
     * < *:* menor que
     * ':' *:* sequ√™ncia 
     

Ao comparar os valores, a sa√≠da ser√° um booleano, ou seja, se a compara√ß√£o √© verdadeira (TRUE) ou falsa (FALSE). Por exemplo:

O valor de **A** (=2) √© igual ao de **a** (=1)?

```{r}
A == a
```

O valor de **a** (=1) √© menor que o de **A** (=2)?

```{r}
a < A
```

O valor de **A** (=2) e de **a** (=1) s√£o diferentes de **c** (=1)?

```{r}
c <- 1
A&a != c
```

Outra opera√ß√£o interessante que podemos fazer com R √© üëâ**acessar os valores contidos em um objeto por sua(s) posi√ß√£o(√µes)üëà**. Para isso, √© comum usar colchetes, onde inserimos a posi√ß√£o da qual queremos saber um valor (`nome_objeto[posi√ß√£o]`) e obtemos o valor dessa posi√ß√£o como uma sa√≠da.

<center>

![](manejo1.png){width="493"}

</center>

Vamos replicar o nosso exemplo em c√≥digo R:

```{r}
objX <- c(20, 21, 22, 23, 24, 25)
objX[1]
```

Se quisermos acessar todos os valores do nosso objeto, exceto uma posi√ß√£o qualquer, podemos usar o s√≠mbolo de menos (`nome_objeto[-posi√ß√£o]`). Por exemplo, se quisermos ver todos os valores de objX, exceto o contido na posi√ß√£o 3:

```{r}
objX[-3]
```

Tamb√©m podemos aplicar operadores matem√°ticos a vetores em conjunto com a indexa√ß√£o:

-   √â poss√≠vel multiplicar os elementos entre 1 e 3 de ObjX por 2...

```{r}
objX[1:3]*2
```

> üëÜ Observe que multiplicar um vetor √© equivalente a multiplicar cada uma de suas entradas pelo valor do multiplicador.

-   ... ou perguntar ao R se os elementos 1 e 5 s√£o iguais a 20.

```{r}
objX[c(1,5)] == 20
```

-   E tamb√©m podemos aplicar fun√ß√µes que calculam algumas estat√≠sticas de tend√™ncia central ou de variabilidade, como a m√©dia e vari√¢ncia:

```{r}
mean(objX[2:5])
var(objX[2:5])
```

**Mas e como fazemos para acessar os valores de uma lista?** ü§î

Assim como os vetores: `nome_lista[posi√ß√£o]`! Por exemplo, qual √© o terceiro elemento do meu objeto "**lista**"?

```{r}
lista[3]
```

Tamb√©m √© poss√≠vel acessar diretamente os valores de um objeto dentro de uma usando dois colchetes: `nome_lista[[posi√ß√£o]]`:

```{r}
lista[[3]]
```

Se eu quiser acessar o 2o elemento do objeto 3 que faz parte da **lista**: `nome_lista[[posi√ß√£o_objeto]][posi√ß√£o_elemento]`.

```{r}
lista[[3]][2]
```

## Importando dados para o R

Mas que tal facilitar a sua vida? Quanto menos esfor√ßo voc√™ colocar para importar e manipular dados com sucesso, melhor ser√° a sua transi√ß√£o para o R. √â mais f√°cil organizar seus dados em um programa como Excel ou Google docs do que fazer esse esfor√ßo diretamente em R (ou qualquer outra linguagem). Para isso, eu recomendo que voc√™ adote algumas boas pr√°ticas:

-   Vari√°veis v√£o nas colunas.

-   Unidades observacionais ou experimentais nas linhas.

-   Apenas um valor por c√©lula (coluna vs. linha = 1 valor).

    ![](bp.png)

-   Evite usar caracteres especiais e espa√ßos no nome de colunas. Exemplo: prefira **endereco** no lugar de **endere√ßo**, **dia_coleta** no lugar de **dia coleta**.

-   N√£o preencha valores faltantes (os famosos NA's) com zeros.

-   Salve suas planilhas em formato **.csv**, **.tsv** ou em **.txt**. Isso facilita a importa√ß√£o para o R.

-   N√£o coloque coment√°rios ou a unidade m√©trica nos seus dados. ‚ö†Ô∏èDica: se voc√™ estiver medindo algo em cent√≠metros, nomeie a coluna como **nomevariavel_cm**.

-   Para vari√°veis categ√≥ricas nominais, verifique se os nomes correspondentes √† mesma caracter√≠stica est√£o escritos da mesma forma. Se, por exemplo, voc√™ est√° nomeando pa√≠ses e escreve Brasil de duas formas diferentes (numa linha Brasil e em outra brasil), R entender√° que s√£o valores diferentes.

-   Quando analisamos dados, geralmente trabalhamos com objetos de duas dimens√µes (linhas vs. colunas). Por isso, ao preencher uma planilha, lembre-se de usar apenas uma aba do seu editor; caso contr√°rio, voc√™ ter√° que despender um esfor√ßo mais significativo para importar e juntar os dados.

-   N√£o sublinhe ou use cores em sua planilha; essas formata√ß√µes n√£o s√£o import√°veis ao R.

### Iris

‚ö†Ô∏è Neste tutorial, trabalharemos com uma famosa planilha de dados - a **iris.csv** - que obedece a todas as regras e dicas pr√©-estabelecidas ([baixe aqui](https://github.com/bellabf/r_pressa)). Ao baixar **iris.csv**, salve-a na mesma pasta do seu computador que est√° sendo mantindo o seu script R. Voc√™ pode verificar qual √© o endere√ßo deste diret√≥rio com o seguinte comando:

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
getwd()

```

O conjunto de dados de √≠ris fornece as medidas (em cent√≠metros) do comprimento e largura da s√©pala e da p√©tala para tr√™s esp√©cies de ir√≠s (Setosa, Versicolor e Virginia), totalizando 150 indiv√≠duos.

![](https://machinelearninghd.com/wp-content/uploads/2021/03/iris-dataset.png){width="660"}

Ap√≥s salvar a planilha no seu diret√≥rio, voc√™ deve usar a fun√ß√£o `read.csv('nome_planilha.csv')` para importar a iris ao R.

```{r}
dados <- read.csv("iris.csv")
dim(dados)
```

Ao chamar o nome da tabela "iris", R exibir√° seu conte√∫do: quatro colunas contendo as medidas das s√©palas (sepal.length e sepal.width) e p√©talas (petal.length e petal.width), uma coluna contendo o nome das esp√©cies de √≠ris (species) e 150 linhas referentes aos indiv√≠duos florais medidos.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)
library(tidyverse)
iris %>% 
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  scroll_box(height = "300px")
```

## Instalando pacotes e carregar uma biblioteca

Vamos aumentar a funcionalidade do R instalando o Tidyverse para uso do pacote **dplyr**.

Para instalar um pacote em R, executamos a fun√ß√£o `install.packages("nome_do_pacote")`. ‚ö† Nome do pacote **entre aspas**!! ‚ö†Ô∏è

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
install.packages("tidyverse")
```

Ap√≥s a instala√ß√£o do tidyverse, √© necess√°rio invoca-lo para uso de suas fun√ß√µes. Para isso, usamos a fun√ß√£o `library(nome_do_pacote)`. ‚ö†Ô∏è Nome do pacote **sem aspas**!! ‚ö†Ô∏è

```{r}
library(tidyverse)
```

## Manipulando dados

O **dplyr** √© um pacote projetado para a manipula√ß√£o de **dataframes**. Suas fun√ß√µes permitem que o gerenciamento de dados seja intuitivo e amig√°vel. Com o dplyr, operamos diretamente os dataframes; contr√°rio ao R base que atua sobre os vetores.

![](https://miro.medium.com/max/1400/1*NXRsFH_12sfj79W-P4qI0Q.png)

O dplyr trabalha com uma gram√°tica de manipula√ß√£o de dados na qual os verbos ditam certas a√ß√µes. Cada verbo tem a sua fun√ß√£o equivalente. Os verbos mais comuns s√£o:

#### MUTATE

    Adiciona novas var√≠aveis em fun√ß√£o de outras (como, por exemplo, percentagem).

#### SELECT

    Seleciona vari√°veis baseada no nome.

#### FILTER

    Seleciona vari√°veis baseada em valores.

#### SUMMARIZE

    Resume variav√©is em valores √∫nicos (como m√©dia).

#### ARRANGE

    Orderna as linhas da tabela.

O tidyverse tem mais um s√≠mbolo "%\>%" ou "\|\>": o pipe. Ele permite agrupar v√°rias opera√ß√µes que seriam realizadas separadamente em um √∫nica opera√ß√£o de maneira mais intuitiva. Todos os comandos que usaremos nesse tutorial ser√£o escritos nesse estilo.

\*B√îNUS: se voc√™ tem planos de aprender SQL no futuro, dplyr vai ter colocar no caminho certo.

### Tutorial do dplyr

Voc√™ pode obter os valores de m√©dia para s√©palas e p√©talas a partir da tabela iris usando o summarise.

```{r}
medias <- dados %>%
          summarise(mean_sepal = mean(Sepal.Length), 
                    mean_petal = mean(Petal.Length))
medias

```

O problema √© que dentro dessa tabela, n√£o existem apenas uma esp√©cie de flor. Para isso, a gente pode combinar o group_by com o summarise.

```{r}
medias_especies <- dados %>%
                    group_by(Species) %>%
                    summarise(mean_sepal = mean(Sepal.Length), 
                              mean_petal = mean(Petal.Length))

medias_especies

```

A gente pode modificar o c√≥digo anterior para temos mais informa√ß√µes como desvio padr√£o e mediana usando fun√ß√µes auxiliares.

```{r}
medias_especies <- dados %>%
  group_by(Species) %>%
  summarise(mean_sepal = mean(Sepal.Length), 
            mean_petal = mean(Petal.Length), 
            median_sepal = median(Sepal.Length),
            median_petal = median(Petal.Length),
            sd_sepal = sd(Sepal.Length),
            sd_petal = sd(Petal.Length),
            n = n())

medias_especies

```

## Salvando seus dados

Por √∫ltimo, voc√™ pode exportar a sua tabela medias_especies usando a fun√ß√£o *write.csv*.

```{r}
write.csv(medias_especies, "medias_especies.csv")

```

### E fim!

Se voc√™ chegou aqui, voc√™ teve uma primeira experi√™ncia em R que eu espero que tenha sido remotamente agrad√°vel e que voc√™ esteja menos aterrorizado de se aventurar em R. No pr√≥ximo, tutorial, nos vamos explorar a mesma tabela de outras formasa, ent√£o fique atento.
