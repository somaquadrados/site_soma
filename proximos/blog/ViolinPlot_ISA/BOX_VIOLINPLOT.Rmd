---
title: "Cinturas em caixas: um tutorial"
author: "Isabella Bicalho Frazeto"
date: "9/6/2021"
output: html_document
---

# Introdu√ß√£o

Voc√™ j√° pensou como as cinturas em caixa podem ser informativas? N√£o? Ent√£o venha comigo neste mini-tutorial que eu vou te mostrar como! üòä

Nas sess√µes [1](#s1) e [2](#s2), mostrarei o que s√£o um *boxplot* e um *violin plot* e discutirei - brevemente üòÖ - as vantagens de usar cada um deles. Na [sess√£o 3](#s3), falo sobre as vantagens de plotar os dois gr√°ficos em conjunto e na [sess√£o 4](#s4) mostro como cria-los em `r fontawesome::fa("r-project", fill = "steelblue")`.

## Box plot {#s1}

O boxplot - tamb√©m conhecido como diagrama de caixa, de quartil ou, meu favorito, gr√°fico de caixa de bigode <img src="mustache.png" style="width: 5%;"/> - √© um gr√°fico que permite visualizar a distribui√ß√£o do nosso conjunto de dados. √â um gr√°fico cl√°ssico em que a mediana √© o centro de uma caixa e o primeiro e o terceiro quartil formam o ret√¢ngulo. Os "bigodes" da caixa s√£o formados pelo limite inferior e pelo limite superior. Normalmente, os outliers (dados discrepantes) s√£o representados por pequenos pontos no gr√°fico.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)

A <- c(runif(25, 5, 20), 32)
B <- c(runif(25, 0, 10), 10)
C <- c(runif(25, 10, 15), 20)

D <- data.frame(A, B, C) %>%
  pivot_longer(1:3, names_to = "Vari√°vel", values_to = "Valores")

D <- D[D$Vari√°vel == "A",]

ggplot(D, aes(x = Vari√°vel, y = Valores)) + 
  geom_boxplot(width = .5, color = "grey30", fill = "grey95", alpha = .9,
               show.legend = F) + 
  theme_light() + 
  annotate( # adicionar anota√ß√£o
  x = 1.1, 
  y = quantile(A)[5], 
  label = "outlier", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 3.5) +
  annotate( # adicionar anota√ß√£o
  x = 1.1, 
  y = quantile(A, probs = 0.95), 
  label = "limite superior", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 3.5) +
  annotate( # adicionar anota√ß√£o
  x = 1.28, 
  y = quantile(A)[4], 
  label = "Q3", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 3.5) +
  annotate( # adicionar anota√ß√£o
  x = 1.31, 
  y = quantile(A)[3], 
  label = "Mediana", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 3.5) +
  annotate( # adicionar anota√ß√£o
  x = 1.31, 
  y = quantile(A)[2], 
  label = "Q1", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 3.5) +
  annotate( # adicionar anota√ß√£o
  x = 1.1, 
  y = quantile(A)[1], 
  label = "limite inferior", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 3.5)
  theme(legend.position="none") # retirar a legenda
```


## Violin plot {#s2}

O violin plot √© bastante similar a um box plot, mas com a vantagem de usar um *kernel de densidade sim√©trico* que se distribui em ambos os lados do "violino"; ou seja, ela tamb√©m consegue refletir a densidade de probabilidade (como um histograma). A maior vantagem √© que ela consegue ser mais informativo que um boxplot, pois mostra todo o conjunto dos dados. Infelizmente, n√£o √© um gr√°fico t√£o popular, o que pode levar a alguma confus√£o sobre sua interpreta√ß√£o.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(D, aes(x = Vari√°vel, y = Valores, fill = Vari√°vel)) + 
  geom_violin(show.legend = F, alpha = .8, color = "grey30") + 
  theme_light() +
  theme(legend.position="none")
```

## Por que usar os dois juntos? {#s3}

O pulo do gato √© que voc√™ pode plotar o boxplot e o plot do violino no mesmo gr√°fico. Esse reflexo √© especialmente importante se seus dados forem multimodais, pois isso fica evidente no gr√°fico de violino e n√£o est√° claro no gr√°fico de caixa. Outra vantagem √© que tamb√©m evita que voc√™ termine com um boxplot, um histograma + estimativa de densidade de kernel para cada vari√°vel. Pela pr√≥pria natureza dos gr√°ficos, tamb√©m √© mais f√°cil visualizar sua amostra por fatores diferentes.

```{r}
ggplot(D, aes(x = Vari√°vel, y = Valores, fill = Vari√°vel)) + 
  geom_violin(show.legend = F, alpha = .6) +
  geom_boxplot(width = .5, fill = "grey95", color = "grey30", alpha = .9,
               show.legend = F) + 
  theme_light() +
  theme(legend.position="none") # retirar a legenda
```


## Tutorial {#s4}

Comece com a instala√ß√£o dos pacotes **ggplot2** e **datasets** no seu ambiente `r fontawesome::fa("r-project", fill = "steelblue")`. Em seguida, carregue os pacotes instalados.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
## Instalar os pacotes
install.packages("ggplot2")
install.packages("datasets")

## Carregar os pacotes
library(datasets)
library(ggplot2)
```

```{r include=FALSE}
library(datasets)
library(ggplot2)
```

Aqui, vamos usar dois data sets diferentes: 'plantGrowth' e o 'beavers'.

```{r}
data("PlantGrowth"); data("InsectSprays")
```

O conjunto de dados PlantGrowth cont√©m os resultados de um experimento que teve como objetivo comparar o crescimento de plantas entre um grupo de controle com dois outros grupos experimentais. A tabela possui duas vari√°veis: *weight* (peso) e *group* (grupo).

```{r}
head(PlantGrowth)
```

J√° o dataset InsectSprays √© o resultado da contagem de insetos em unidades experimentais agr√≠colas tratadas com diferentes inseticidas. Possui duas colunas: *count* (quantidade) e *spray*.

```{r}
head(InsectSprays)
```

## PlantGrowth

Com o ggplot2 √© poss√≠vel plotar dois gr√°ficos "sobrepostos" em uma √∫nica figura. Para isso utilizamos o simbolo "soma" (+) que vai "unir" dois objetos geom√©tricos *gg*. Na sequ√™ncia vemos o primeiro gr√°fico criado.

```{r}
ggplot(PlantGrowth, aes(x = weight, # no eixo 'x' vai o peso
                        y = group)) + # no eixo y os 'grupo
        geom_violin() + # plotar o violin plot
        geom_boxplot()  # plotar o boxplot
```

Como nosso primeiro gr√°fico n√£o tem uma est√©tica bonita, √© poss√≠vel executar alguns comandos para torn√°-lo mais agrad√°vel e informativo.

O primeiro passo √© mudar a largura dos boxplots. Para isso, usaremos o comando `width = 0.3` como par√£metro dentro da chamada do `boxplot()`. Tamb√©m vamos mudar o tema com a fun√ß√£o `theme_light()`. O objetivo √© deixar o gr√°fico mais coeso.

```{r}
ggplot(PlantGrowth, aes(x=weight, y=group)) + 
  theme_light() + # mudan√ßa de tema (est√©tica) do background
  geom_violin() +
  geom_boxplot(width = 0.3) # diminui√ß√£o das caixas
```

Em seguida, voc√™ pode escolher alterar o √¢ngulo das caixas, colocando-as na vertical. Nesse caso, apenas pe√ßa que as coordenadas sejam invertidas usando `coord_flip()`.

```{r}
ggplot(PlantGrowth, aes(x=weight, y=group)) + 
  theme_light() +
  geom_violin() +
  geom_boxplot(width = 0.3) +
  coord_flip() # caixas na vertical
```

Por fim, vamos colorir os violinos e deixas as caixas com contornos em cinza. Para tal usaremos as fun√ß√µes `aes(fill = group, color = group, alpha = 0.5)` em `geom_violin()` e `color = "grey20"` em `geom_boxplot()`. Tamb√©m vamos remover a legenda do gr√°fico, pois a distin√ß√£o entre grupos j√° est√° explicada no eixo x com `theme(legend.position = "none")`.

```{r}
ggplot(PlantGrowth, aes(x = weight, y = group)) + 
  theme_light() +
  geom_violin(aes(fill = group, # colorir o interior dos violinos em fun√ß√£o dos grupos
                  color = group, # colorir o contorno dos violinos em fun√ß√£o dos grupos
                  alpha = 0.5)) + # deixar as cores transparentes (50% de transpar√™ncia)
  geom_boxplot(width = 0.3, 
               color = "grey30") + # contorne do boxplot em cinza
  coord_flip() +
  theme(legend.position="none") # retirar a legenda
```

## Insect Sprays

E que tal um segundo exemplo bem simples e charmoso com os dados de InsectSprays?

```{r}
ggplot(InsectSprays, # tabela de dados
       aes(x = spray, # no eixo 'x' os grupos da coluna spray
           y = count, # no eixo 'y' a contagem de insetos
           color = spray)) + # colorir os gr√°ficos em fun√ß√£o de 'spray'
  theme_light() + # mudar o tema do gr√°fico - cores e estilo do background
  geom_violin() + # plotar o violino
  geom_boxplot(width = 0.05) # plotar as caixas mais 'finas' que o default
```

## FIM!!

O que voc√™ achou do texto? Queremos saber a sua opini√£o! ‚úåÔ∏è

Tamb√©m estamos a disposi√ß√£o para d√∫vidas! üëáüëá

Voc√™ pode deixar um coment√°rio nesta postagem (basta logar pelo GitHub) ou l√° no nosso twitter!

<blockquote class="twitter-tweet">

<p lang="und" dir="ltr">

<a href="https://t.co/WstWLEAGlC">https://t.co/WstWLEAGlC</a> <a href="https://t.co/u6ycSLDsSj">pic.twitter.com/u6ycSLDsSj</a>

</p>

--- Soma dos Quadrados (@somaquadrados) <a href="https://twitter.com/somaquadrados/status/1438491288513429513?ref_src=twsrc%5Etfw">September 16, 2021</a>

</blockquote>

```{=html}
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
```
(obs: depois que postar o texto no blog, vou fazer um tweet e substituir esse c√≥digo pelo tweet realizado)
