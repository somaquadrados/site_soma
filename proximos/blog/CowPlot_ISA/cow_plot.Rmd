---
title: "cowplot"
author: "Isabella Bicalho Frazeto"
date: "9/18/2021"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

# Sobre o pacote

O **Cowplot** [üêÑ](https://emojipedia.org/cow/) √© um pacote que foi
projetado para ser um *add-on* do `ggplot`. As caracter√≠sticas mais
not√°veis s√£o temas, alinhamento, organiza√ß√£o de figuras em v√°rios
pain√©is gr√°ficos e fun√ß√µes que facilitam a anota√ß√£o de plotagens ou
mesmo mesclar nossos gr√°ficos com outras imagens. Meu objetivo neste
tutorial n√£o √© usar o pacote extensivamente, mas sim mostrar a voc√™ as
fun√ß√µes que eu mais uso ao trabalhar com gr√°ficos.

# Dados

Neste tutorial, usaremos a [Tabela Nutricional do
McDonald's](menu.csv)*.*

```{r message=FALSE, warning=FALSE}
## Pacotes ----
library(ggplot2) 
library(cowplot) #<<
library(dplyr)

## Dados ----
menu <- read.csv("menu.csv")

## Visualizar a tabela ----
glimpse(menu)
```

# Temas e *background_grid*

Apesar de ter conhecido o cowplot pela aplicabilidade em pain√©is, sempre
acabo utilizando-o em outros tipos de projetos pela facilidade de
lembrar os temas que desejo. Por exemplo, quando preciso de um gr√°fico
mais *clean,* eu uso a fun√ß√£o *theme_half_open(),* que tem um design
simples, sem *background* e um estilo de eixo semiaberto (duas linhas no
eixo do quadrantes inferiores esquerdos). Em seguida, vou usar esse tema
para criar um gr√°fico *scatter plot* entre as vari√°veis "*Total.Fat*" e
"*Calories*".

```{r}
ggplot(menu, aes(x = Calories, 
                 y = Total.Fat, 
                 color = Category)) + 
            geom_point() + 
            theme_half_open() ## < tema do cowplot
```

Veja que, com a ajuda do cowplot, rapidamente tivemos um gr√°fico
produzido com um tema *clean* e que est√° pronto para ser publicado! O
mais legal √© que o tema ainda tem a op√ß√£o de alterar o tamanho do texto
no t√≠tulo, no corpo do gr√°fico e assim por diante. Para obter mais
informa√ß√µes sobre essa fun√ß√£o, execute o c√≥digo: `?theme_half_open()`.

*background_grid* tamb√©m √© uma das minhas fun√ß√µes preferidas porque, bem
üòÖ, √© a fun√ß√£o da qual me lembro quando quero colocar um plano de fundo
(*background* üëå). Vamos executar um exemplo de com dois gr√°ficos de
dispers√£o:

```{r}
## Gordura total vs. caloria
g_fat <- ggplot(menu, aes(x=Calories, y=Total.Fat, color = Category)) + 
            geom_point() +
            theme_half_open() +
            background_grid() # <<

g_fat

## Prote√≠na vs. caloria
g_protein <- ggplot(menu, aes(x = Calories, y = Protein, color = Category)) + 
              geom_point() +
              theme_half_open() +
              background_grid() # <<


g_protein
```

Outro tema que eu costumo usar com frequ√™ncia √© o *theme_minimal*. De
novo, o pacote me ganha pela usabilidade porque ele possui "duas
variantes": *theme_minimal_hgrid*, que adiciona linhas na horizontal, e
o *theme_minimal_vgrid*, que adiciona linhas na vertical. Por √∫ltimo,
outro *add-on* que considero muito pr√°tico √© o *panel_border,* que
adicionar bordas ao pan√©is.

```{r fig.height=10, fig.width=8, message=FALSE, warning=FALSE}
# Histograma para os dados de gordura total
## Com o theme_minimal_hgrid
hist_fat <- ggplot(menu, aes(x = Total.Fat, fill = Category)) + 
              geom_histogram() +
              facet_grid(vars(Category),  labeller = as_labeller(NULL)) +
              theme_minimal_hgrid() + #<<
              panel_border(color='black') + #<<,
              theme(strip.text.y  = element_blank()) 

hist_fat


# Histograma para os dados de prote√≠na
## Com o theme_minimal_vgrid
hist_protein <- ggplot(menu, aes(x = Protein, fill = Category)) + 
                  geom_histogram() +
                  facet_grid(vars(Category)) +
                  theme_minimal_vgrid() + #<<
                  panel_border(color='black') + #<<
                  theme(strip.text.y  = element_blank()) 

hist_protein

```

# Pain√©is

Por √∫ltimo, cowplot tem um fun√ß√£o semelhante ao `par(mfrow)` do
`r fontawesome::fa("r-project", fill = "steelblue")` base. A partir
dela, voc√™ √© capaz de gerar pain√©is com v√°rios gr√°ficos em uma √∫nica
figura. Vamos fazer tr√™s pan√©is: O primeiro para combinar os dois
gr√°ficos de dispers√£o (p_1), o segundo para combinar os dois gr√°ficos de
histograma (p_2) e o terceiro vai combinar o I e II. (p_3)

## Painel I

Primeiro, observe que se usarmos apenas a fun√ß√£o `plot_grid()` sem levar
a legenda em considera√ß√£o, ela ficar√° assim:

```{r fig.height=4, fig.width=8}
plot_grid(g_fat, g_protein, labels = c("A", "B"), label_size = 12)
```

Obviamente, o painel n√£o √© muito bom, pois os dois gr√°ficos compartilham
a mesma legenda (ü§ï). A solu√ß√£o ent√£o √© a seguinde:

1\. Fazer um gr√°fico apenas com os gr√°ficos e sem nenhuma legenda
(*prow*).

```{r message=FALSE, warning=FALSE}
prow <- plot_grid(
  g_fat + theme(legend.position="none"),
  g_protein + theme(legend.position="none"),
  align = 'vh',
  labels = c("A", "B"),
  hjust = -1,
  nrow = 1, 
  label_size = 12
)
```

2\. Extrair a legenda usando *get_legend* (tamb√©m do cowplot).

```{r}
legend <- get_legend(
  g_protein + theme()
)

```

3\. Combinar num novo grid *prow* e a legenda.

```{r fig.height=6, fig.width=10}
p1 <- plot_grid(prow, legend)
p1

```

## Painel II

Vamos repetir os mesmo passos realizados no [Painel I], agora com os
histogramas:

```{r fig.height=9, fig.width=12}

## Unir os gr√°ficos
prow2 <- plot_grid(
  hist_fat + theme(legend.position="none"), 
  hist_protein + theme(legend.position="none"),
  align = 'vh',
  labels = c("A", "B"),
  hjust = -1,
  nrow = 1, 
  label_size = 12
)

## Criar um objeto para a legenda
legend2 <- get_legend(
  hist_protein + theme()
)

## Criar o gr√°fico
p2 <- plot_grid(prow2, legend2)
p2
```

## Painel III

Finalmente, o √∫ltimo painel; nele incluiremos os quatro gr√°ficos
criados, no entanto, precisamos ter apenas uma legenda.

```{r fig.height=9, fig.width=12}
plot_grid(prow, prow2, nrow = 2) %>%
  plot_grid(legend2, align = "hv", axis = "l", nrow = 1)

```

Para finalizar, precisamos arrumar as propor√ß√µes do gr√°ficos. Para isso
vamos utilizar as fun√ß√µes `rel_heights = c(t1, t2))` e
`rel_widths = c(t1, t2)`, que alteram a altura e a largura,
respectivamente. Dentro colocamos o tamanho que vamos querer para cada
figura na ordem em que elas s√£o inclusas na fun√ß√£o.

```{r fig.height=9, fig.width=12}
p3 <- plot_grid(prow, prow2, nrow = 2, 
                rel_heights = c(6, 12), 
                rel_widths = c(2, 2)) %>%
  plot_grid(legend2, align = "v", axis = "l", nrow = 1,
             rel_heights = c(3, 0.8), rel_widths = c(2, 0.5)
            )
p3
```

E fim ü•≥! Agora voc√™ pode fazer os seus pr√≥prios pain√©is usando cowplot.
E ai, quais figuras lndas voc√™ t√° pensando em criar com esse pacote?
Conte para n√≥s!

\
