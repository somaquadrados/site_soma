---
title: '{PT} Cinturas em caixas: um tutorial'
layout: single-sidebar
excerpt: "VocÃª jÃ¡ pensou como as cinturas em caixas podem ser informativas? NÃ£o? EntÃ£o venha comigo neste mini-tutorial que eu vou te mostrar como! ğŸ˜Š"
author: Isabella Bicalho Frazeto
date: '2021-09-28'
slug: ViolinPlot
categories: 
  - Graficos
tags: 
  - PT
  - Graficos
images: ~
series: ~
alt: ''
featured: yes
draft: no
image:
  focal_point: 'Center'
  preview_only: no
lastmod: '2021-09-28'
---

# IntroduÃ§Ã£o

VocÃª jÃ¡ pensou como as cinturas em caixas podem ser informativas? NÃ£o? EntÃ£o venha comigo neste mini-tutorial que eu vou te mostrar como! ğŸ˜Š

Nas sessÃµes [1](#s1) e [2](#s2), mostrarei o que sÃ£o um *boxplot* e um *violin plot* e discutirei - brevemente ğŸ˜… - as vantagens de usar cada um deles. Na [sessÃ£o 3](#s3), falo sobre as vantagens de plotar os dois grÃ¡ficos em conjunto e na [sessÃ£o 4](#s4) mostro como cria-los em `r fontawesome::fa("r-project", fill = "steelblue")`.

## Box plot {#s1}

O boxplot - tambÃ©m conhecido como diagrama de caixa, de quartil ou, meu favorito, grÃ¡fico de caixa de bigode <img src="mustache.png" style="width: 5%;"/> - Ã© um grÃ¡fico que permite visualizar a distribuiÃ§Ã£o do nosso conjunto de dados. Ã‰ um grÃ¡fico clÃ¡ssico em que a mediana Ã© o centro de uma caixa e o primeiro e o terceiro quartil formam o retÃ¢ngulo. Os "bigodes" da caixa sÃ£o formados pelo limite inferior e pelo limite superior. Normalmente, os outliers (dados discrepantes) sÃ£o representados por pequenos pontos no grÃ¡fico.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)
A <- data.frame("VariÃ¡vel" = rep("A", 26), "Valores" = c(runif(25, 5, 20), 32))
ggplot(A, aes(x = VariÃ¡vel, y = Valores)) + 
  geom_boxplot(width = .5, color = "grey30", fill = "grey95", alpha = .9,
               show.legend = F) + 
  theme_light() + 
  annotate( # adicionar anotaÃ§Ã£o
  x = 1.05, 
  y = quantile(A[,2])[5], 
  label = "outlier", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 4) +
  annotate( # adicionar anotaÃ§Ã£o
  x = 1.1, 
  y = quantile(A[,2], probs = 0.95), 
  label = "limite superior", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 4) +
  annotate( # adicionar anotaÃ§Ã£o
  x = 1.28, 
  y = quantile(A[,2])[4], 
  label = "Q3", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 4) +
  annotate( # adicionar anotaÃ§Ã£o
  x = 1.31, 
  y = quantile(A[,2])[3], 
  label = "Mediana", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 4) +
  annotate( # adicionar anotaÃ§Ã£o
  x = 1.31, 
  y = quantile(A[,2])[2], 
  label = "Q1", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 4) +
  annotate( # adicionar anotaÃ§Ã£o
  x = 1.1, 
  y = quantile(A[,2])[1], 
  label = "limite inferior", 
  geom = "text", 
  color = "blue", 
  family = "Bell MT",
  size = 4) 
```


## Violin plot {#s2}

O violin plot Ã© bastante similar a um box plot, mas com a vantagem de usar um *kernel de densidade simÃ©trico* que se distribui em ambos os lados do "violino"; ou seja, ela tambÃ©m consegue refletir a densidade de probabilidade (como aquela linha que a gente costuma ver em cima do histograma). A maior do violin plot Ã© que ela consegue ser mais informativo que um boxplot, pois mostra todo o conjunto dos dados. Infelizmente, nÃ£o Ã© um grÃ¡fico tÃ£o popular, o que pode levar a alguma confusÃ£o sobre sua interpretaÃ§Ã£o.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(A, aes(x = VariÃ¡vel, y = Valores, fill = VariÃ¡vel)) + 
  geom_violin(show.legend = F, alpha = .8, color = "grey30") + 
  theme_light() +
  theme(legend.position="none")
```

## Por que usar os dois juntos? {#s3}

O salto do gato Ã© que vocÃª pode plotar o boxplot e o plot do violino no mesmo grÃ¡fico. Essa sobreposiÃ§Ã£o Ã© especialmente importante se seus dados forem multimodais, pois isso Ã© evidente no grÃ¡fico de violino e nÃ£o no grÃ¡fico de caixa. Outra vantagem Ã© que tambÃ©m evita que vocÃª termine com um boxplot, um histograma + estimativa de densidade de kernel para cada variÃ¡vel. Pela prÃ³pria natureza dos grÃ¡ficos, tambÃ©m Ã© mais fÃ¡cil visualizar sua amostra por fatores diferentes.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(A, aes(x = VariÃ¡vel, y = Valores, fill = VariÃ¡vel)) + 
  geom_violin(show.legend = F, alpha = .6) +
  geom_boxplot(width = .5, fill = "grey95", color = "grey30", alpha = .9,
               show.legend = F) + 
  theme_light() +
  theme(legend.position="none") # retirar a legenda
```


## Tutorial {#s4}

Comece com a instalaÃ§Ã£o dos pacotes **ggplot2** e **datasets** no seu ambiente `r fontawesome::fa("r-project", fill = "steelblue")`. Em seguida, carregue os pacotes instalados.

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
## Instalar os pacotes
install.packages("ggplot2")
install.packages("datasets")
## Carregar os pacotes
library(datasets)
library(ggplot2)
```

```{r include=FALSE}
library(datasets)
library(ggplot2)
```

Aqui, vamos usar dois data sets diferentes: 'plantGrowth' e o 'InsectSprays'.

```{r}
data("PlantGrowth"); data("InsectSprays")
```

O conjunto de dados PlantGrowth contÃ©m os resultados de um experimento que teve como objetivo comparar o crescimento de plantas entre um grupo de controle com dois outros grupos experimentais. A tabela possui duas variÃ¡veis: *weight* (peso) e *group* (grupo).

```{r}
head(PlantGrowth)
```

JÃ¡ o dataset InsectSprays Ã© o resultado da contagem de insetos em unidades experimentais agrÃ­colas tratadas com diferentes inseticidas. Possui duas colunas: *count* (quantidade) e *spray*.

```{r}
head(InsectSprays)
```

## PlantGrowth

Com o ggplot2 Ã© possÃ­vel plotar dois grÃ¡ficos "sobrepostos" em uma Ãºnica figura. Para isso utilizamos o simbolo "soma" (+) que vai "unir" dois objetos geomÃ©tricos *gg*. Na sequÃªncia vemos o primeiro grÃ¡fico criado.

```{r}
ggplot(PlantGrowth, aes(x = weight, # no eixo 'x' vai o peso
                        y = group)) + # no eixo y os 'grupo
        geom_violin() + # plotar o violin plot
        geom_boxplot()  # plotar o boxplot
```

Como nosso primeiro grÃ¡fico nÃ£o tem uma estÃ©tica bonita, Ã© possÃ­vel executar alguns comandos para tornÃ¡-lo mais agradÃ¡vel e informativo.

O primeiro passo Ã© mudar a largura dos boxplots. Para isso, usaremos o comando `width = 0.3` como parÃ¢metro dentro da chamada do `boxplot()`. TambÃ©m vamos mudar o tema com a funÃ§Ã£o `theme_light()`. O objetivo Ã© deixar o grÃ¡fico mais coeso.

```{r}
ggplot(PlantGrowth, aes(x = weight, y = group)) + 
  theme_light() + # mudanÃ§a de tema (estÃ©tica) do background
  geom_violin() +
  geom_boxplot(width = 0.3) # diminuiÃ§Ã£o das caixas
```

Em seguida, vocÃª pode escolher alterar o Ã¢ngulo das caixas, colocando-as na vertical. Nesse caso, apenas peÃ§a que as coordenadas sejam invertidas usando `coord_flip()`.

```{r}
ggplot(PlantGrowth, aes(x = weight, y = group)) + 
  theme_light() +
  geom_violin() +
  geom_boxplot(width = 0.3) +
  coord_flip() # caixas na vertical
```

Por fim, vamos colorir os violinos e deixas as caixas com contornos em cinza. Para tal usaremos as funÃ§Ãµes `aes(fill = group, color = group, alpha = 0.5)` em `geom_violin()` e `color = "grey20"` em `geom_boxplot()`. TambÃ©m vamos remover a legenda do grÃ¡fico com `theme(legend.position = "none")`, pois a distinÃ§Ã£o entre grupos jÃ¡ estÃ¡ explicada no eixo x.

```{r}
ggplot(PlantGrowth, aes(x = weight, y = group)) + 
  theme_light() +
  geom_violin(aes(fill = group, # colorir o interior dos violinos em funÃ§Ã£o dos grupos
                  color = group, # colorir o contorno dos violinos em funÃ§Ã£o dos grupos
                  alpha = 0.5)) + # deixar as cores transparentes (50% de transparÃªncia)
  geom_boxplot(width = 0.3, 
               color = "grey30") + # contorno do boxplot em cinza escuro
  coord_flip() +
  theme(legend.position = "none") # retirar a legenda
```

## Insect Sprays

E que tal um segundo exemplo bem simples e charmoso com os dados de InsectSprays?

```{r}
ggplot(InsectSprays, # tabela de dados
       aes(x = spray, # no eixo 'x' os grupos da coluna spray
           y = count, # no eixo 'y' a contagem de insetos
           color = spray)) + # colorir os grÃ¡ficos em funÃ§Ã£o de 'spray'
  theme_light() + # mudar o tema do grÃ¡fico - cores e estilo do background
  geom_violin() + # plotar o violino
  geom_boxplot(width = 0.05) # plotar as caixas mais 'finas' que o default
```

## FIM!!

O que vocÃª achou do texto? Queremos saber a sua opiniÃ£o! âœŒï¸

TambÃ©m estamos a disposiÃ§Ã£o para dÃºvidas! ğŸ‘‡ğŸ‘‡

VocÃª pode deixar um comentÃ¡rio nesta postagem (basta logar pelo GitHub) ou lÃ¡ no nosso twitter!

<blockquote class="twitter-tweet"><p lang="pt" dir="ltr">ğŸ‘‰ğŸ¾ Ei, vocÃª conhece o nosso blog? Veja as nossas postagens em <a href="https://t.co/YDGvDef4PF">https://t.co/YDGvDef4PF</a>!<br><br>------<br><br>ğŸ‘‰ğŸ¾ Oye, Â¿conoces nuestro blog? Â¡Vea nuestras publicaciones en <a href="https://t.co/YDGvDef4PF">https://t.co/YDGvDef4PF</a>!</p>&mdash; Soma dos Quadrados (@somaquadrados) <a href="https://twitter.com/somaquadrados/status/1442970277567160320?ref_src=twsrc%5Etfw">September 28, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>